<!DOCTYPE html>
<meta charset="utf-8">
<style>
svg {
    font: 10px sans-serif;
    shape-rendering: crispEdges;
  }
.bar--positive {
  fill: steelblue;
}
.bar--negative {
  fill: darkorange;
}
.axis text {
  font: 10px sans-serif;
}

.axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/d3.v4.min.js"></script>
<script>
const width = 900;
    const height = 400;
    const margin = {top: 20, right: 20, bottom: 40, left: 40};
    const names = ['CompNews', 'CompPTT', 'CEONews', 'CEOPTT', 'IndusNews', 'IndusPTT', 'ProdNews', 'ProdPTT'];
	var dataset = JSON.parse('{{ data | tojson | safe}}');
    const values = [Math.max.apply(Math, dataset.map(function(o) { return o.start+o.len; })), Math.min.apply(Math, dataset.map(function(o) { return o.start; }))];


// Transpose the data into layers


	var color = ["b33040", "#d25c4d", "#F9E79F", "c7e9c0", "74c476", "3182bd"];

    const svg = d3.select('body').append('svg').attr('width', width + margin.left + margin.right)
      .attr('height', height + margin.top + margin.bottom);
    const g = svg.append('g').attr('transform', `translate(${margin.left},${margin.top})`);
    const x = d3.scaleLinear().domain(d3.extent(values)).range([0, width]);
    const y = d3.scaleBand().domain(names).range([0, height], 0.1);

    var groups = g.selectAll("g.cost")
  .data(dataset)
  .enter().append("g")
  .attr("class", "cost")
  .style("fill", function(d, i) { return color[i]; });
  
	g.selectAll('.bar').data(dataset)
      .enter().append('rect')
      .attr('class', d => 'bar bar--' + (d < 0 ? 'negative' : 'positive'))
      .attr('x', function(d) { console.log(d);return x(d.start);})
      .attr('y', function(d) { return y(d.n); })
      .attr('width', function(d) { return x(d.len); })
      .attr('height', y.bandwidth() - 5)
	  .style("fill", function(d) { return color[d.s]; });

    g.append('g')
      .attr('class', 'x axis')
      .attr('transform', `translate(0,${height})`)
      .call(d3.axisBottom(x));
    g.append('g')
      .attr('class', 'y axis')
      .attr('transform', `translate(${x(0)},0)`)
      .call(d3.axisLeft(y).tickSize(0).tickPadding(6));
  
  var legend = svg.selectAll(".legend")
  .data(color)
  .enter().append("g")
  .attr("class", "legend")
  .attr("transform", function(d, i) { return "translate(30," + i * 12 + ")"; });
 
legend.append("rect")
  .attr("x", width - 30)
  .attr("width", 10)
  .attr("height", 10)
  .style("fill", function(d, i) {return color.slice()[i];});
 
legend.append("text")
  .attr("x", width - 15)
  .attr("y", 5)
  .attr("dy", ".35em")
  .style("text-anchor", "start",)
  .text(function(d, i) { 
    switch (i) {
      case 0: return "Highly Negative";
      case 1: return "Mid Negative";
      case 2: return "Low Negative";
      case 3: return "Low Positive";
	  case 4: return "Mid Positive";
	  case 5: return "Highly Positive";

    }
  });
  
  
  
</script>
</body>